{% extends "base.html" %}
{% load static %}

{% block title %}Meu JC{% endblock %}

{% block content %}

<!-- ESTILO DA P√ÅGINA DE PERFIL -->
<style>
    /* === ESTILOS DA P√ÅGINA PRINCIPAL === */
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #fff;
        overflow-x: hidden;
    }
    
    /* Header da p√°gina de perfil */
    .profile-header {
        background: #c30000;
        padding: 10px 0;
        display: flex;
        justify-content: center;
    }
    
    .profile-header img {
        height: 45px;
    }
    
    /* Se√ß√£o do perfil */
    .perfil-section {
        text-align: center;
        padding: 20px 0 10px;
        position: relative;
        z-index: 1;
    }
    
    .foto-container {
        display: flex;
        justify-content: center;
    }
    
    .foto {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #c30000;
    }
    
    .username {
        margin-top: 10px;
        font-size: 14px;
        color: #555;
    }
    
    .menu-lista {
        width: 90%;
        margin: 10px auto 20px;
    }
    
    .menu-lista a {
        display: flex;
        justify-content: space-between;
        padding: 14px;
        border-bottom: 1px solid #ddd;
        color: #222;
        text-decoration: none;
        font-size: 15px;
    }
    
    .menu-lista i {
        margin-right: 10px;
        color: #c30000;
    }
    
    .bloco {
        padding: 12px 15px;
        border-bottom: 6px solid #f6f6f6;
        position: relative;
        z-index: 1;
    }
    
    .bloco h3 {
        margin: 5px 0 12px;
        font-size: 16px;
        color: #444;
    }
    
    .salvos {
        display: flex;
        gap: 12px;
        overflow-x: auto;
        padding-bottom: 8px;
    }
    
    .salvo-card {
        min-width: 180px;
    }
    
    .salvo-card img {
        width: 100%;
        height: 100px;
        object-fit: cover;
        border-radius: 6px;
    }
    
    .salvo-card p {
        font-size: 13px;
        color: #333;
        margin-top: 6px;
    }
    
    .tags {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }
    
    .tags span {
        background: #f0f0f0;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 13px;
        color: #555;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin: 3px;
        transition: all 0.2s ease;
        border: 1px solid #ddd;
    }

    .tags span:hover {
        background: #e0e0e0;
        transform: translateY(-2px);
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .tags .tag-selectable {
        background: #e9e9e9;
        padding: 8px 15px 8px 12px;
        border-radius: 20px;
        font-size: 13px;
        color: #333;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin: 4px;
        cursor: pointer;
        user-select: none;
        border: 1px solid transparent;
        transition: all 0.2s ease;
    }

    .tags .tag-selectable:hover {
        background: #d9d9d9;
        transform: translateY(-2px);
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .tags .tag-selectable.selected {
        background: #b30000;
        color: white;
        padding-right: 12px;
    }

    .tags .tag-selectable.selected::after {
        content: '√ó';
        font-size: 16px;
        font-weight: bold;
        margin-left: 4px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        background: rgba(255,255,255,0.2);
        border-radius: 50%;
        transition: all 0.2s ease;
    }

    .tags .tag-selectable.selected:hover::after {
        background: rgba(255,255,255,0.3);
        transform: scale(1.1);
    }

    
    .colunistas {
        display: flex;
        gap: 14px;
        overflow-x: auto;
        padding-bottom: 10px;
    }
    
    .colunista {
        text-align: center;
        min-width: 90px;
    }
    
    .colunista img {
        width: 65px;
        height: 65px;
        border-radius: 50%;
        object-fit: cover;
    }
    
    .colunista p {
        font-size: 12px;
    }
    
    .page-footer {
        background: #e6e6e6;
        text-align: center;
        padding: 15px 5px;
        font-size: 12px;
        color: #444;
        position: relative;
        z-index: 1;
    }
    
    .page-footer img {
        width: 160px;
        margin: 10px 0;
    }
    
    .page-footer .copy {
        margin-top: 10px;
        font-size: 11px;
    }
    
    .menu-bottom {
        position: fixed;
        bottom: 0;
        width: 100%;
        background: #fff;
        border-top: 1px solid #ccc;
        display: flex;
        justify-content: space-around;
        padding: 12px 0;
        font-size: 20px;
        z-index: 100;
    }
    
    .menu-bottom a {
        color: #c30000;
        text-decoration: none;
    }
    
    /* Bot√£o para abrir sidebar (sobreposto) */
    .sidebar-toggle-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #c30000;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        z-index: 9998;
        box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        font-size: 14px;
    }
    
    .sidebar-toggle-btn:hover {
        background: #a00000;
    }
    
    /* === ESTILOS COMPLETOS DA SIDEBAR === */
    
    /* Overlay escuro */
    .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease;
        z-index: 9997;
    }
    
    .sidebar-overlay.active {
        opacity: 1;
        visibility: visible;
    }
    
    /* Container da Sidebar */
    .sidebar-container {
        position: fixed;
        top: 0;
        right: -380px;
        width: 380px;
        height: 100vh;
        background: white;
        padding: 30px;
        box-shadow: -2px 0 10px rgba(0,0,0,0.2);
        transition: right 0.3s ease-in-out;
        z-index: 9998;
        box-sizing: border-box;
        overflow-y: auto;
    }
    
    .sidebar-container.active {
        right: 0;
    }
    
    /* Estilos gerais da sidebar */
    .sidebar-container h2 {
        text-align: center;
        color: #a40000;
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 26px;
    }
    
    .sidebar-container h3 {
        text-align: center;
        color: #a40000;
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 20px;
    }
    
    /* Inputs */
    .sidebar-input {
        width: 100%;
        padding: 14px;
        border-radius: 10px;
        border: none;
        background: #e4edff;
        margin-bottom: 14px;
        font-size: 15px;
        box-sizing: border-box;
    }
    
    /* Bot√µes */
    .sidebar-btn-action {
        width: 100%;
        padding: 14px;
        border-radius: 10px;
        border: none;
        background: #b30000;
        color: white;
        font-size: 17px;
        margin-top: 10px;
        cursor: pointer;
        font-weight: bold;
        display: block;
        text-align: center;
        text-decoration: none;
        box-sizing: border-box;
    }
    
    .sidebar-btn-action:hover {
        background: #8a0000;
    }
    
    .sidebar-btn-secondary {
        margin-top: 15px;
        width: 100%;
        display: block;
        padding: 12px;
        color: #b30000;
        border: 2px solid #b30000;
        border-radius: 10px;
        text-decoration: none;
        font-weight: bold;
        text-align: center;
        box-sizing: border-box;
        background: white;
        cursor: pointer;
    }
    
    .sidebar-btn-secondary:hover {
        background: #ffeaea;
    }
    
    /* Informa√ß√µes de login */
    .sidebar-login-info {
        font-size: 13px;
        color: #666;
        text-align: center;
        margin-bottom: 20px;
        padding: 10px;
        background: #f0f0f0;
        border-radius: 5px;
    }
    
    .sidebar-login-link {
        color: #b30000;
        background: none;
        border: none;
        cursor: pointer;
        font-weight: bold;
        text-decoration: underline;
        padding: 0;
        font-size: 14px;
    }
    
    /* Bot√£o mostrar/ocultar senha */
    .sidebar-toggle-password {
        position: absolute;
        right: 10px;
        top: 35px;
        background: none;
        border: none;
        cursor: pointer;
        color: #666;
        font-size: 12px;
    }
    
    .sidebar-toggle-password:hover {
        color: #b30000;
    }
    
    /* Estilos de perfil na sidebar */
    .sidebar-profile-container {
        padding: 10px 0;
    }
    
    .sidebar-profile-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 30px;
    }
    
    .sidebar-profile-avatar {
        width: 80px;
        height: 80px;
        background: #ccc;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 10px;
        color: #fff;
        font-size: 40px;
        cursor: pointer;
    }
    
    .sidebar-change-photo-link {
        color: #b30000;
        text-decoration: none;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
    }
    
    .sidebar-change-photo-link:hover {
        text-decoration: underline;
    }
    
    /* Grupos de formul√°rio */
    .sidebar-form-group {
        margin-bottom: 25px;
        position: relative;
    }
    
    .sidebar-form-group label {
        display: block;
        color: #444;
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .sidebar-display-field {
        width: 100%;
        padding: 12px;
        border-radius: 5px;
        border: none;
        background: #e9e9e9;
        margin-bottom: 5px;
        font-size: 15px;
        color: #333;
        pointer-events: none;
        box-sizing: border-box;
        transition: all 0.3s ease;
    }
    
    .sidebar-display-field.editable {
        background: #e4edff;
        border: 1px solid #b30000;
        pointer-events: auto;
    }
    
    .sidebar-change-link {
        color: #b30000;
        text-decoration: none;
        font-size: 12px;
        cursor: pointer;
        display: inline-block;
        margin-top: 5px;
    }
    
    .sidebar-change-link:hover {
        text-decoration: underline;
    }
    
    /* Bot√µes de edi√ß√£o */
    .sidebar-edit-buttons {
        display: none;
        gap: 10px;
        margin-top: 10px;
    }
    
    .sidebar-edit-buttons.active {
        display: flex;
    }
    
    .sidebar-btn-save {
        flex: 1;
        padding: 8px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
    }
    
    .sidebar-btn-save:hover {
        background: #218838;
    }
    
    .sidebar-btn-cancel {
        flex: 1;
        padding: 8px;
        background: #6c757d;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
    }
    
    .sidebar-btn-cancel:hover {
        background: #5a6268;
    }
    
    /* Tags */
    .sidebar-tags-container {
        margin-top: 30px;
        margin-bottom: 40px;
    }
    
    .sidebar-tags-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .sidebar-tag-item {
        background: #e9e9e9;
        padding: 8px 15px 8px 12px;
        border-radius: 20px;
        color: #333;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        user-select: none;
        border: 1px solid transparent;
        margin: 3px;
    }
    
    .sidebar-tag-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 3px 5px rgba(0,0,0,0.1);
        background: #d9d9d9;
    }
    
    .sidebar-tag-item.selected {
        background: #b30000;
        color: white;
        padding-right: 12px;
    }

    .sidebar-tag-item.selected::after {
        content: '√ó';
        font-size: 16px;
        font-weight: bold;
        margin-left: 4px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        background: rgba(255,255,255,0.2);
        border-radius: 50%;
        transition: all 0.2s ease;
    }
    
    .sidebar-tag-item.selected:hover::after {
        background: rgba(255,255,255,0.3);
        transform: scale(1.1);
    }

    .tags, .sidebar-tags-list {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        align-items: center;
        margin-top: 10px;
    }

    /* Footer da sidebar */
    .sidebar-footer-buttons {
        margin-top: 40px;
        padding-top: 20px;
        text-align: center;
    }
    
    .sidebar-social-links {
        display: flex;
        justify-content: space-around;
        margin-top: 25px;
        margin-bottom: 10px;
    }
    
    .sidebar-social-links a {
        color: #b30000;
        font-size: 30px;
        text-decoration: none;
        cursor: pointer;
    }
    
    .sidebar-social-links a:hover {
        opacity: 0.8;
    }
    
    /* Modal */
    .sidebar-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 10000;
        align-items: center;
        justify-content: center;
    }
    
    .sidebar-modal.active {
        display: flex;
    }
    
    .sidebar-modal-content {
        background: white;
        padding: 30px;
        border-radius: 10px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .sidebar-modal-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }
    
    .sidebar-modal-btn {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
    }
    
    .sidebar-btn-primary {
        background: #b30000;
        color: white;
    }
    
    .sidebar-btn-secondary-modal {
        background: #6c757d;
        color: white;
    }
    
    /* Mensagens tempor√°rias */
    .temp-message {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 12px 24px;
        border-radius: 8px;
        color: white;
        font-weight: bold;
        z-index: 10001;
        animation: slideDown 0.3s ease;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        font-size: 14px;
        text-align: center;
        min-width: 200px;
        max-width: 300px;
    }
    
    @keyframes slideDown {
        from {
            top: -50px;
            opacity: 0;
        }
        to {
            top: 20px;
            opacity: 1;
        }
    }
    
    /* Outros estilos da sidebar */
    .sidebar-recovery-instructions {
        font-size: 14px;
        color: #666;
        text-align: center;
        margin-bottom: 20px;
        line-height: 1.5;
    }
    
    .sidebar-recovery-success {
        background: #d4edda;
        color: #155724;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        text-align: center;
        border: 1px solid #c3e6cb;
    }
    
    .sidebar-login-hint {
        text-align: center;
        font-size: 14px;
        color: #666;
        margin-top: 15px;
        margin-bottom: 10px;
    }
    
    .sidebar-forgot-password-link {
        text-align: center;
        margin-top: 10px;
        margin-bottom: 15px;
    }
    
    /* Links de redes sociais */
    .social-icons {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
    }
    
    .social-icons img {
        width: 30px;
        height: 30px;
    }
    
    /* Redefini√ß√£o de senha */
    .recovery-steps {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        font-size: 14px;
    }
    
    .recovery-step {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        padding: 8px;
        border-radius: 5px;
        background: white;
    }
    
    .step-number {
        background: #b30000;
        color: white;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        font-weight: bold;
    }

        /* Redefini√ß√£o de senha */
    .recovery-steps {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        font-size: 14px;
    }
    
    .recovery-step {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        padding: 8px;
        border-radius: 5px;
        background: white;
    }
    
    .step-number {
        background: #b30000;
        color: white;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        font-weight: bold;
    }
</style>

<!-- Bot√£o para abrir sidebar (sobreposto) -->
<button class="sidebar-toggle-btn" onclick="openSidebar()" id="sidebarToggle">Login</button>

<!-- CONTE√öDO DA P√ÅGINA DE PERFIL -->
<header class="profile-header">
    <img src="{% static 'img/logo_jcpe.png' %}" alt="Logo JCPE">
</header>

<section class="perfil-section">
    <div class="foto-container">
        {% if user.perfil.foto %}
            <img src="{{ user.perfil.foto.url }}" class="foto" alt="Foto do perfil">
        {% else %}
            <img src="{% static 'img/user.jpg' %}" class="foto" alt="Foto padr√£o">
        {% endif %}
    </div>

    <p class="username">@{{ user.username }}</p>

    <div class="menu-lista">
        <a href="{% url 'editar_conta' %}">
            <i class="fa-solid fa-user"></i> Editar Perfil
        </a>
        <a href="#">
            <i class="fa-solid fa-bell"></i> Notifica√ß√µes
        </a>
        <a href="#">
            <i class="fa-solid fa-universal-access"></i> Acessibilidade
        </a>
        <a href="{% url 'logout' %}">
            <i class="fa-solid fa-right-from-bracket"></i> Sair
        </a>
    </div>
</section>

<section class="bloco">
    <h3>SALVOS</h3>
    <div class="salvos">
        {% if noticias_salvas %}
            {% for item in noticias_salvas %}
                <div class="salvo-card">
                    {% if item.noticia.imagem %}
                        <img src="{{ item.noticia.imagem.url }}" alt="{{ item.noticia.titulo }}">
                    {% else %}
                        <img src="{% static 'img/sem_capa.jpg' %}" alt="Sem imagem">
                    {% endif %}
                    <p>{{ item.noticia.titulo|truncatechars:50 }}</p>
                </div>
            {% endfor %}
        {% else %}
            <p style="font-size:13px;color:#777;">Voc√™ ainda n√£o salvou mat√©rias.</p>
        {% endif %}
    </div>
</section>

<section class="bloco">
    <h3>FAVORITOS</h3>
    <h4 style="margin-top:10px">TAGS</h4>
    <div class="tags">
        {% if tags %}
            {% for tag in tags %}
                <span>{{ tag.tag }}</span>
            {% endfor %}
        {% else %}
            <span>Voc√™ ainda n√£o favoritou tags.</span>
        {% endif %}
    </div>
</section>

<section class="bloco">
    <h3>COLUNISTAS</h3>
    <div class="colunistas">
        {% if colunistas %}
            {% for col in colunistas %}
                <div class="colunista">
                    <img src="{{ col.foto.url }}" alt="{{ col.nome }}">
                    <p>{{ col.nome }}</p>
                </div>
            {% endfor %}
        {% else %}
            <p style="font-size:13px;color:#777;">Sem favoritos ainda.</p>
        {% endif %}
    </div>
</section>

<footer class="page-footer">
    <p>√öltimas Not√≠cias JC+</p>
    <p>Newsletters ‚Ä¢ Mobile ‚Ä¢ Fale conosco</p>
    <img src="{% static 'img/socials.png' %}" alt="Redes sociais">
    <p class="copy">¬© JCPE 2025</p>
</footer>

<nav class="menu-bottom">
    <a href="{% url 'inicial' %}">
        <i class="fa-solid fa-house"></i>
    </a>
    <a href="{% url 'criar_noticia' %}">
        <i class="fa-solid fa-square-plus"></i>
    </a>
    <a href="{% url 'conta' %}">
        <i class="fa-solid fa-bars"></i>
    </a>
</nav>

<!-- ============================ -->
<!-- SIDEBAR COMPLETA -->
<!-- ============================ -->

<div id="sidebarOverlay" class="sidebar-overlay" onclick="closeSidebar()"></div>

<!-- Modal para foto de perfil -->
<div id="photoModal" class="sidebar-modal">
    <div class="sidebar-modal-content">
        <h3>Alterar Foto de Perfil</h3>
        <p>Selecione uma nova imagem para seu perfil:</p>
        
        <form id="photoForm" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="file" id="photoInput" name="photo" accept="image/*" style="margin: 15px 0; width: 100%; padding: 10px; border: 2px dashed #ccc; border-radius: 8px;">
            
            <!-- Pr√©-visualiza√ß√£o da imagem -->
            <div id="imagePreview" style="text-align: center; margin: 15px 0; display: none;">
                <img id="previewImage" src="" alt="Pr√©-visualiza√ß√£o" style="max-width: 200px; max-height: 200px; border-radius: 50%; border: 3px solid #c30000;">
                <p style="font-size: 12px; color: #666; margin-top: 5px;">Pr√©-visualiza√ß√£o</p>
            </div>
            
            <div class="sidebar-modal-buttons">
                <button type="button" class="sidebar-modal-btn sidebar-btn-primary" onclick="savePhoto()">Salvar Foto</button>
                <button type="button" class="sidebar-modal-btn sidebar-btn-secondary-modal" onclick="closeModal()">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<div id="sidebar" class="sidebar-container">
    <!-- TELA DE LOGIN -->
    <div id="loginContent">
        <h2>Entrar</h2>
        
        <div class="sidebar-login-info">
            Use seu nome de usu√°rio <strong>ou</strong> e-mail para fazer login
        </div>
        
        <form id="loginForm" method="POST">
            {% csrf_token %}
            {% if erro %}
                <div style="color: #dc3545; font-size: 14px; margin-bottom: 10px; padding: 10px; background: #f8d7da; border-radius: 5px;">
                    {{ erro }}
                </div>
            {% endif %}

            <input type="text" id="loginIdentifier" placeholder="Nome de usu√°rio ou E-mail" class="sidebar-input" required>
            
            <div style="position: relative;">
                <input type="password" id="loginPassword" placeholder="Senha" class="sidebar-input" required>
                <button type="button" class="sidebar-toggle-password" onclick="togglePassword('loginPassword')">üëÅ</button>
            </div>
            
            <button type="submit" class="sidebar-btn-action">Entrar</button>
            
            <div class="sidebar-forgot-password-link">
                <button type="button" class="sidebar-login-link" onclick="showForgotPassword()">Esqueci minha senha</button>
            </div>
            
            <div class="sidebar-login-hint">
                N√£o tem uma conta? 
                <button class="sidebar-login-link" onclick="showRegisterForm()">Criar conta</button>
            </div>
        </form>
    </div>

    <!-- TELA DE ESQUECI A SENHA -->
    <div id="forgotPasswordContent" style="display: none;">
        <h2>Recuperar Senha</h2>
        
        <div class="recovery-steps">
            <div class="recovery-step">
                <div class="step-number">1</div>
                <span>Digite seu nome de usu√°rio ou e-mail</span>
            </div>
            <div class="recovery-step">
                <div class="step-number">2</div>
                <span>Clique em "Enviar instru√ß√µes"</span>
            </div>
            <div class="recovery-step">
                <div class="step-number">3</div>
                <span>Use o c√≥digo abaixo para redefinir</span>
            </div>
        </div>
        
        <form id="forgotPasswordForm">
            {% csrf_token %}
            <input type="text" id="recoveryIdentifier" placeholder="Nome de usu√°rio ou E-mail" class="sidebar-input" required>
            <button type="submit" class="sidebar-btn-action">Enviar Instru√ß√µes</button>
            <button type="button" class="sidebar-btn-secondary" onclick="showLoginForm()">Voltar para Login</button>
        </form>
        
        <div id="recoverySuccess" class="sidebar-recovery-success" style="display: none;">
            <h3>‚úÖ C√≥digo Gerado!</h3>
            <p>Enviamos um e-mail para <strong id="recoveryEmail"></strong> com as instru√ß√µes.</p>
            
            <!-- C√ìDIGO QUE APARECE NA TELA -->
            <div style="background: #fff; border: 2px dashed #155724; padding: 15px; margin: 15px 0; border-radius: 8px; text-align: center;">
                <p style="margin: 0 0 10px; font-size: 12px; color: #666;">SEU C√ìDIGO DE RECUPERA√á√ÉO:</p>
                <div id="recoveryCode" style="font-size: 24px; font-weight: bold; letter-spacing: 3px; color: #155724; padding: 10px; background: #f8f9fa; border-radius: 5px; font-family: monospace;">
                </div>
                <p style="font-size: 11px; color: #666; margin-top: 10px;">Use este c√≥digo para redefinir sua senha</p>
            </div>
            
            <p><strong>Como usar:</strong></p>
            <ol style="text-align: left; font-size: 13px; margin: 10px 0; padding-left: 20px;">
                <li>Copie o c√≥digo acima</li>
                <li>Clique em "Redefinir com C√≥digo"</li>
                <li>Cole o c√≥digo e crie sua nova senha</li>
            </ol>
            
            <button type="button" class="sidebar-btn-action" style="background: #28a745; margin-top: 10px;" onclick="useRecoveryCode()">Redefinir com C√≥digo</button>
            <p style="font-size: 11px; color: #666; margin-top: 10px;">* Este c√≥digo expira em 10 minutos</p>
        </div>
        
        <div id="recoveryError" style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 8px; margin-top: 20px; text-align: center; border: 1px solid #f5c6cb; display: none;">
            <h3>‚ö† N√£o encontramos esse usu√°rio</h3>
            <p>Verifique se digitou corretamente seu nome de usu√°rio ou e-mail.</p>
            <button type="button" class="sidebar-login-link" onclick="showRegisterForm()" style="margin-top: 10px;">Criar uma nova conta?</button>
        </div>
    </div>

    <!-- TELA DE REDEFINIR SENHA COM C√ìDIGO -->
    <div id="resetPasswordContent" style="display: none;">
        <h2>Redefinir Senha</h2>
        
        <div class="sidebar-login-info">
            Digite o c√≥digo recebido e sua nova senha
        </div>
        
        <form id="resetPasswordForm">
            {% csrf_token %}
            
            <div style="position: relative;">
                <input type="text" id="resetCode" placeholder="C√≥digo de recupera√ß√£o (6 d√≠gitos)" class="sidebar-input" required maxlength="6" style="letter-spacing: 2px; font-size: 18px; text-align: center;">
                <button type="button" class="sidebar-toggle-password" onclick="copyRecoveryCode()" style="right: 10px; top: 12px;">üìã</button>
            </div>
            
            <div style="position: relative;">
                <input type="password" id="newPassword" placeholder="Nova senha (m√≠nimo 6 caracteres)" class="sidebar-input" required>
                <button type="button" class="sidebar-toggle-password" onclick="togglePassword('newPassword')">üëÅ</button>
            </div>
            
            <div style="position: relative;">
                <input type="password" id="confirmNewPassword" placeholder="Confirmar nova senha" class="sidebar-input" required>
                <button type="button" class="sidebar-toggle-password" onclick="togglePassword('confirmNewPassword')">üëÅ</button>
            </div>
            
            <button type="submit" class="sidebar-btn-action">Redefinir Senha</button>
            <button type="button" class="sidebar-btn-secondary" onclick="showForgotPassword()">Voltar</button>
        </form>
        
        <div id="resetSuccess" class="sidebar-recovery-success" style="display: none;">
            <h3>‚úÖ Senha Redefinida!</h3>
            <p>Sua senha foi alterada com sucesso.</p>
            <p>Voc√™ j√° pode fazer login com sua nova senha.</p>
            <button type="button" class="sidebar-btn-action" style="margin-top: 15px;" onclick="showLoginForm()">Fazer Login</button>
        </div>
    </div>

    <!-- TELA DE REGISTRO -->
    <div id="registerContent" style="display: none;">
        <h2>Criar Conta</h2>
        
        <div class="sidebar-login-info">
            Voc√™ poder√° fazer login usando seu nome de usu√°rio <strong>ou</strong> e-mail
        </div>
        
        <form id="registerForm">
            {% csrf_token %}
            <input type="text" id="registerUsername" placeholder="Nome de usu√°rio (m√≠nimo 3 caracteres)" class="sidebar-input" required>
            <input type="email" id="registerEmail" placeholder="E-mail" class="sidebar-input" required>
            
            <div style="position: relative;">
                <input type="password" id="registerPassword" placeholder="Senha (m√≠nimo 6 caracteres)" class="sidebar-input" required>
                <button type="button" class="sidebar-toggle-password" onclick="togglePassword('registerPassword')">üëÅ</button>
            </div>
            
            <div style="position: relative;">
                <input type="password" id="registerConfirmPassword" placeholder="Confirmar senha" class="sidebar-input" required>
                <button type="button" class="sidebar-toggle-password" onclick="togglePassword('registerConfirmPassword')">üëÅ</button>
            </div>
            
            <button type="submit" class="sidebar-btn-action">Criar Conta</button>
            <button type="button" class="sidebar-btn-secondary" onclick="showLoginForm()">Voltar para Login</button>
        </form>
    </div>

    <!-- TELA DE PERFIL (usu√°rio logado) -->
    <div id="profileContent" style="display: none;">
        <div class="sidebar-profile-container">
            <div class="sidebar-profile-header">
                <div class="sidebar-profile-avatar" title="Clique para alterar" onclick="openPhotoModal()">üë§</div>
                <a href="#" class="sidebar-change-photo-link" onclick="openPhotoModal(); return false;">Alterar foto de perfil</a>
            </div>

            <div class="sidebar-form-group" id="usernameGroup">
                <label>Nome de Usu√°rio</label>
                <input type="text" id="usernameInput" class="sidebar-display-field" readonly>
                <a href="#" class="sidebar-change-link" onclick="enableEdit('username'); return false;">Alterar nome de usu√°rio</a>
                <div class="sidebar-edit-buttons" id="usernameButtons">
                    <button class="sidebar-btn-save" onclick="saveEdit('username')">Salvar</button>
                    <button class="sidebar-btn-cancel" onclick="cancelEdit('username')">Cancelar</button>
                </div>
            </div>
            
            <div class="sidebar-form-group" id="emailGroup">
                <label>E-mail</label>
                <input type="email" id="emailInput" class="sidebar-display-field" readonly>
                <a href="#" class="sidebar-change-link" onclick="enableEdit('email'); return false;">Alterar e-mail</a>
                <div class="sidebar-edit-buttons" id="emailButtons">
                    <button class="sidebar-btn-save" onclick="saveEdit('email')">Salvar</button>
                    <button class="sidebar-btn-cancel" onclick="cancelEdit('email')">Cancelar</button>
                </div>
            </div>

            <div class="sidebar-form-group" id="passwordGroup">
                <label>Senha</label>
                <div style="position: relative;">
                    <input type="password" id="passwordInput" value="" class="sidebar-display-field" readonly>
                    <button type="button" class="sidebar-toggle-password" onclick="togglePassword('passwordInput')" style="top: 12px;">üëÅ</button>
                </div>
                <a href="#" class="sidebar-change-link" onclick="enableEdit('password'); return false;">Alterar senha</a>
                <div class="sidebar-edit-buttons" id="passwordButtons">
                    <button class="sidebar-btn-save" onclick="saveEdit('password')">Salvar</button>
                    <button class="sidebar-btn-cancel" onclick="cancelEdit('password')">Cancelar</button>
                </div>
            </div>

            <div class="sidebar-tags-container">
                <h3>Tags de Interesse</h3>
                <div class="sidebar-tags-list" id="tagsList">
                    <div class="loading-tags">Carregando tags...</div>
                </div>
                <p style="font-size: 11px; color: #666; margin-top: 10px;">
                    As tags s√£o salvas automaticamente no seu navegador.
                </p>
            </div>

            <div class="sidebar-footer-buttons">
                <div style="background: #fff; padding: 10px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                    <button class="sidebar-btn-action" style="margin-top: 0; background: #b30000;" onclick="logout()">Sair da Conta</button>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">Op√ß√µes de conta</p>
                </div>

                <div class="social-icons">
                    <a href="https://www.instagram.com/jc_pe/?hl=en" target="_blank" rel="noopener noreferrer">
                        <img src="{% static 'img/instagram.png' %}" alt="Instagram">
                    </a>
                    <a href="https://x.com/jc_pe?lang=en" target="_blank" rel="noopener noreferrer">
                        <img src="{% static 'img/x.png' %}" alt="X">
                    </a>
                    <a href="https://www.tiktok.com/@jc_pe" target="_blank" rel="noopener noreferrer">
                        <img src="{% static 'img/tiktok.png' %}" alt="TikTok">
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ====================
    // SISTEMA COMPLETO DA SIDEBAR
    // ====================
    
    // Sistema de autentica√ß√£o
    let isLoggedIn = false;
    let currentUser = null;
    
    // Sistema de tags
    const TAGS_DATA = [
        {id: 'politica_nacional', name: 'Pol√≠tica Nacional'},
        {id: 'mercado_financeiro', name: 'Mercado Financeiro'},
        {id: 'relacoes_internacionais', name: 'Rela√ß√µes Internacionais'},
        {id: 'inteligencia_artificial', name: 'Intelig√™ncia Artificial'},
        {id: 'pesquisa_cientifica', name: 'Pesquisa Cient√≠fica'},
        {id: 'futebol', name: 'Futebol'},
        {id: 'cinema', name: 'Cinema'},
        {id: 'mudancas_climaticas', name: 'Mudan√ßas Clim√°ticas'},
        {id: 'seguranca_publica', name: 'Seguran√ßa P√∫blica'},
        {id: 'ensino_superior', name: 'Ensino Superior'}
    ];
    
    function getCSRFToken() {
        const name = 'csrftoken';
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    async function makeRequest(url, method, data = null) {
        const csrfToken = getCSRFToken();
        const options = {
            method: method,
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            credentials: 'same-origin'
        };
        
        if (data) {
            options.body = JSON.stringify(data);
        }
        
        try {
            const response = await fetch(url, options);
            return await response.json();
        } catch (error) {
            console.error('Erro na requisi√ß√£o:', error);
            return { success: false, message: 'Erro de conex√£o com o servidor.' };
        }
    }
    
    // Fun√ß√µes da Sidebar
    function openSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        
        sidebar.classList.add('active');
        overlay.classList.add('active');
        
        // Verificar status de login
        checkLoginStatus();
    }
    
    function closeSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
    }
    
    // Alternar entre telas da sidebar
    function showForgotPassword() {
        document.getElementById("loginContent").style.display = "none";
        document.getElementById("registerContent").style.display = "none";
        document.getElementById("forgotPasswordContent").style.display = "block";
        document.getElementById("resetPasswordContent").style.display = "none";
        document.getElementById("profileContent").style.display = "none";
        document.getElementById("recoverySuccess").style.display = "none";
        document.getElementById("recoveryError").style.display = "none";
        document.getElementById("forgotPasswordForm").reset();
    }
    
    function showResetPassword() {
        document.getElementById("loginContent").style.display = "none";
        document.getElementById("registerContent").style.display = "none";
        document.getElementById("forgotPasswordContent").style.display = "none";
        document.getElementById("resetPasswordContent").style.display = "block";
        document.getElementById("profileContent").style.display = "none";
        document.getElementById("resetSuccess").style.display = "none";
    }
    
    function showRegisterForm() {
        document.getElementById("loginContent").style.display = "none";
        document.getElementById("registerContent").style.display = "block";
        document.getElementById("forgotPasswordContent").style.display = "none";
        document.getElementById("resetPasswordContent").style.display = "none";
        document.getElementById("profileContent").style.display = "none";
        document.getElementById("registerForm").reset();
    }
    
    function showLoginForm() {
        document.getElementById("loginContent").style.display = "block";
        document.getElementById("registerContent").style.display = "none";
        document.getElementById("forgotPasswordContent").style.display = "none";
        document.getElementById("resetPasswordContent").style.display = "none";
        document.getElementById("profileContent").style.display = "none";
        document.getElementById("loginForm").reset();
        document.getElementById("forgotPasswordForm").reset();
        document.getElementById("recoverySuccess").style.display = "none";
        document.getElementById("recoveryError").style.display = "none";
    }
    
    function showProfileContent() {
        document.getElementById("loginContent").style.display = "none";
        document.getElementById("registerContent").style.display = "none";
        document.getElementById("forgotPasswordContent").style.display = "none";
        document.getElementById("resetPasswordContent").style.display = "none";
        document.getElementById("profileContent").style.display = "block";
        
        // Preencher dados do usu√°rio
        if (currentUser) {
            document.getElementById('usernameInput').value = currentUser.username;
            document.getElementById('emailInput').value = currentUser.email || '';
        }
        
        // Carregar tags
        loadTags();
    }
    
    // Fun√ß√£o para mostrar/ocultar senha
    function togglePassword(inputId) {
        const input = document.getElementById(inputId);
        if (input.type === "password") {
            input.type = "text";
        } else {
            input.type = "password";
        }
    }
    
    // ====================
    // SISTEMA DE AUTENTICA√á√ÉO
    // ====================
    
    // Fun√ß√£o principal para verificar status de login
    async function checkLoginStatus() {
        console.log('Verificando status de login...');
        
        // O Django injeta uma vari√°vel global quando o usu√°rio est√° logado
        {% if user.is_authenticated %}
            console.log('Usu√°rio autenticado pelo Django');
            isLoggedIn = true;
            currentUser = {
                username: '{{ user.username }}',
                email: '{{ user.email }}',
                id: {{ user.id }}
            };
            
            // Atualizar bot√£o e mostrar perfil
            document.getElementById('sidebarToggle').textContent = 'Minha Conta';
            showProfileContent();
            
            // Atualizar perfil da p√°gina principal
            if (document.querySelector('.username')) {
                document.querySelector('.username').textContent = '@{{ user.username }}';
            }
            
            return;
        {% endif %}
        
        try {
            const response = await makeRequest('/api/check_auth/', 'GET');
            console.log('Resposta da API check_auth:', response);
            
            if (response.authenticated) {
                isLoggedIn = true;
                currentUser = response.user;
                document.getElementById('sidebarToggle').textContent = 'Minha Conta';
                showProfileContent();
                
                // Atualizar perfil da p√°gina principal
                if (document.querySelector('.username')) {
                    document.querySelector('.username').textContent = '@' + currentUser.username;
                }
            } else {
                isLoggedIn = false;
                currentUser = null;
                document.getElementById('sidebarToggle').textContent = 'Login';
                showLoginForm();
            }
        } catch (error) {
            console.error('Erro ao verificar autentica√ß√£o:', error);
            // Em caso de erro, mostrar tela de login
            isLoggedIn = false;
            currentUser = null;
            document.getElementById('sidebarToggle').textContent = 'Login';
            showLoginForm();
        }
    }
    
    // Formul√°rio de login
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        console.log('Tentando login...');
        
        const identifier = document.getElementById('loginIdentifier').value.trim();
        const password = document.getElementById('loginPassword').value;
        
        if (!identifier || !password) {
            showMessage('Por favor, preencha todos os campos.', 'error');
            return;
        }
        
        const response = await makeRequest('/api/login/', 'POST', {
            identifier: identifier,
            password: password
        });
        
        console.log('Resposta do login:', response);
        
        if (response.success) {
            showMessage(response.message, 'success');
            currentUser = response.user;
            
            // Atualizar status
            await checkLoginStatus();
            
            // Limpar formul√°rio
            document.getElementById('loginForm').reset();
            
            // Fechar sidebar e recarregar
            setTimeout(() => {
                closeSidebar();
                window.location.reload();
            }, 1500);
        } else {
            showMessage(response.message || 'Erro ao fazer login', 'error');
        }
    });
    
    // Formul√°rio de registro
    document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const username = document.getElementById('registerUsername').value.trim();
        const email = document.getElementById('registerEmail').value.trim();
        const password = document.getElementById('registerPassword').value;
        const confirmPassword = document.getElementById('registerConfirmPassword').value;
        
        if (!username || !email || !password || !confirmPassword) {
            showMessage('Por favor, preencha todos os campos.', 'error');
            return;
        }
        
        if (!validateEmail(email)) {
            showMessage('Por favor, insira um e-mail v√°lido.', 'error');
            return;
        }
        
        if (password.length < 6) {
            showMessage('A senha deve ter pelo menos 6 caracteres.', 'error');
            return;
        }
        
        if (password !== confirmPassword) {
            showMessage('As senhas n√£o coincidem.', 'error');
            return;
        }
        
        if (username.length < 3) {
            showMessage('O nome de usu√°rio deve ter pelo menos 3 caracteres.', 'error');
            return;
        }
        
        const response = await makeRequest('/api/register/', 'POST', {
            username: username,
            email: email,
            password: password
        });
        
        if (response.success) {
            showMessage(response.message, 'success');
            currentUser = response.user;
            
            // Atualizar status
            await checkLoginStatus();
            
            document.getElementById('registerForm').reset();
            
            setTimeout(() => {
                closeSidebar();
                window.location.reload();
            }, 2000);
        } else {
            showMessage(response.message, 'error');
        }
    });
    
    // Fun√ß√£o de logout
    async function logout() {
        const response = await makeRequest('/api/logout/', 'POST');
        
        if (response.success) {
            isLoggedIn = false;
            currentUser = null;
            showMessage(response.message, 'success');
            
            // Atualizar interface
            checkLoginStatus();
            showLoginForm();
            closeSidebar();
            
            // Recarregar p√°gina
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        }
    }
    
    // Fun√ß√µes de Edi√ß√£o de Campos
    function enableEdit(field) {
        const input = document.getElementById(field + 'Input');
        const buttons = document.getElementById(field + 'Buttons');
        const changeLink = input.nextElementSibling;
        
        window.originalValues = window.originalValues || {};
        window.originalValues[field] = input.value;
        
        input.classList.add('editable');
        input.readOnly = false;
        
        if (field === 'password') {
            input.type = 'password';
            input.value = '';
            input.placeholder = 'Digite a nova senha';
        }
        
        changeLink.style.display = 'none';
        buttons.classList.add('active');
        input.focus();
    }
    
    async function saveEdit(field) {
        const input = document.getElementById(field + 'Input');
        const buttons = document.getElementById(field + 'Buttons');
        const changeLink = buttons.previousElementSibling;
        const newValue = input.value.trim();
        
        if (!newValue) {
            alert('Por favor, preencha o campo.');
            return;
        }
        
        if (field === 'email') {
            if (!validateEmail(newValue)) {
                alert('Por favor, insira um e-mail v√°lido.');
                return;
            }
        }
        
        if (field === 'password') {
            if (newValue.length < 6) {
                alert('A senha deve ter pelo menos 6 caracteres.');
                return;
            }
        }
        
        if (field === 'username') {
            if (newValue.length < 3) {
                alert('O nome de usu√°rio deve ter pelo menos 3 caracteres.');
                return;
            }
        }
        
        const data = {};
        data[field] = newValue;
        
        const response = await makeRequest('/api/update_profile/', 'POST', data);
        
        if (response.success) {
            showMessage(response.message, 'success');
            
            if (field !== 'password') {
                currentUser = response.user;
            }
            
            if (field === 'password') {
                input.type = 'password';
                input.value = '********';
            }
            
            input.classList.remove('editable');
            input.readOnly = true;
            buttons.classList.remove('active');
            changeLink.style.display = 'inline-block';
            
            // Atualizar nome na p√°gina principal se mudou username
            if (field === 'username' && document.querySelector('.username')) {
                document.querySelector('.username').textContent = '@' + newValue;
            }
        } else {
            alert(response.message || 'Erro ao atualizar perfil');
        }
    }
    
    function cancelEdit(field) {
        const input = document.getElementById(field + 'Input');
        const buttons = document.getElementById(field + 'Buttons');
        const changeLink = buttons.previousElementSibling;
        
        if (field === 'password') {
            input.value = '********';
            input.type = 'password';
        } else if (window.originalValues && window.originalValues[field]) {
            input.value = window.originalValues[field];
        }
        
        input.classList.remove('editable');
        input.readOnly = true;
        buttons.classList.remove('active');
        changeLink.style.display = 'inline-block';
    }
    
    // Valida√ß√£o de e-mail
    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }
    
    // Sistema de tags
    function loadTags() {
        const tagsList = document.getElementById('tagsList');
        if (!tagsList) return;
        
        const savedTags = JSON.parse(localStorage.getItem('selectedTags') || '[]');
        
        tagsList.innerHTML = '';
        
        TAGS_DATA.forEach(tag => {
            const isSelected = savedTags.includes(tag.id);
            const tagElement = document.createElement('button');
            tagElement.type = 'button';
            tagElement.className = 'sidebar-tag-item';
            if (isSelected) tagElement.classList.add('selected');
            tagElement.setAttribute('data-tag', tag.id);
            tagElement.setAttribute('data-name', tag.name);
            tagElement.textContent = tag.name;
            tagElement.title = `Clique para ${isSelected ? 'remover' : 'adicionar'} esta tag`;
            tagsList.appendChild(tagElement);
        });
        
        setupTagEvents();
    }
    
    function setupTagEvents() {
        const tags = document.querySelectorAll('.sidebar-tag-item');
        
        tags.forEach(tag => {
            tag.addEventListener('click', function() {
                const tagId = this.getAttribute('data-tag');
                const tagName = this.getAttribute('data-name');
                const isSelected = this.classList.contains('selected');
                
                this.classList.toggle('selected');
                updateLocalStorageTags();
                
                showMessage(
                    `Tag "${tagName}" ${isSelected ? 'removida' : 'adicionada'}!`, 
                    'success'
                );
            });
        });
    }
    
    function updateLocalStorageTags() {
        const tags = document.querySelectorAll('.sidebar-tag-item');
        const selectedTags = [];
        tags.forEach(tag => {
            if (tag.classList.contains('selected')) {
                selectedTags.push(tag.getAttribute('data-tag'));
            }
        });
        localStorage.setItem('selectedTags', JSON.stringify(selectedTags));
    }
    
    // Fun√ß√£o para mostrar mensagens
    function showMessage(text, type) {
        const existingMessages = document.querySelectorAll('.temp-message');
        existingMessages.forEach(msg => msg.remove());
        
        const colors = {
            'success': '#28a745',
            'error': '#dc3545',
            'info': '#17a2b8',
            'warning': '#ffc107'
        };
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `temp-message ${type}`;
        messageDiv.textContent = text;
        messageDiv.style.background = colors[type] || colors.info;
        
        document.body.appendChild(messageDiv);
        
        setTimeout(() => {
            if (messageDiv.parentNode) {
                messageDiv.style.opacity = '0';
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.remove();
                    }
                }, 300);
            }
        }, 3000);
    }
    
    // Fechar sidebar e modal com ESC
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeSidebar();
            closeModal();
        }
    });
    
    // Fechar modal ao clicar fora
    document.getElementById('photoModal').addEventListener('click', function(event) {
        if (event.target === this) {
            closeModal();
        }
    });
    
    // Inicializar quando a p√°gina carregar
    document.addEventListener('DOMContentLoaded', function() {
        console.log('P√°gina carregada - inicializando sistema de login');
        
        // Verificar status inicial
        checkLoginStatus();
        
        // Adicionar eventos aos bot√µes de alterar
        document.querySelectorAll('.sidebar-change-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const onclickAttr = this.getAttribute('onclick');
                if (onclickAttr) {
                    const match = onclickAttr.match(/'(\w+)'/);
                    if (match) {
                        enableEdit(match[1]);
                    }
                }
            });
        });
        
        // Adicionar eventos aos bot√µes de salvar
        document.querySelectorAll('.sidebar-btn-save').forEach(btn => {
            btn.addEventListener('click', function() {
                const onclickAttr = this.getAttribute('onclick');
                if (onclickAttr) {
                    const match = onclickAttr.match(/'(\w+)'/);
                    if (match) {
                        saveEdit(match[1]);
                    }
                }
            });
        });
        
        // Adicionar eventos aos bot√µes de cancelar
        document.querySelectorAll('.sidebar-btn-cancel').forEach(btn => {
            btn.addEventListener('click', function() {
                const onclickAttr = this.getAttribute('onclick');
                if (onclickAttr) {
                    const match = onclickAttr.match(/'(\w+)'/);
                    if (match) {
                        cancelEdit(match[1]);
                    }
                }
            });
        });
    });
    // ====================
// FUN√á√ïES PARA FOTO DE PERFIL
// ====================

// Fun√ß√£o para abrir modal de foto
function openPhotoModal() {
    document.getElementById("photoModal").style.display = "flex";
    
    // Resetar pr√©-visualiza√ß√£o
    document.getElementById('imagePreview').style.display = 'none';
    document.getElementById('photoInput').value = '';
}

// Fun√ß√£o para fechar modal
function closeModal() {
    document.getElementById("photoModal").style.display = "none";
    document.getElementById("photoInput").value = '';
    document.getElementById('imagePreview').style.display = 'none';
}

// Pr√©-visualiza√ß√£o da imagem
document.getElementById('photoInput')?.addEventListener('change', function(e) {
    const preview = document.getElementById('imagePreview');
    const previewImage = document.getElementById('previewImage');
    const file = e.target.files[0];
    
    if (file) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            previewImage.src = e.target.result;
            preview.style.display = 'block';
        }
        
        reader.readAsDataURL(file);
    } else {
        preview.style.display = 'none';
    }
});

// Fun√ß√£o para salvar foto
async function savePhoto() {
    const fileInput = document.getElementById('photoInput');
    const file = fileInput?.files[0];
    
    if (!file) {
        alert('Por favor, selecione uma imagem.');
        return;
    }
    
    // Validar tamanho
    if (file.size > 5 * 1024 * 1024) {
        alert('A imagem deve ter no m√°ximo 5MB.');
        return;
    }
    
    // Validar tipo
    if (!file.type.match('image.*')) {
        alert('Por favor, selecione apenas arquivos de imagem.');
        return;
    }
    
    // Criar FormData
    const formData = new FormData();
    formData.append('photo', file);
    formData.append('csrfmiddlewaretoken', getCSRFToken());
    
    showMessage('Enviando foto...', 'info');
    
    try {
        const response = await fetch('/api/update_profile_photo/', {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            showMessage(data.message, 'success');
            
            // Atualizar avatar na sidebar
            const avatar = document.querySelector('.sidebar-profile-avatar');
            if (avatar && data.foto_url) {
                avatar.innerHTML = `<img src="${data.foto_url}" alt="Foto" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover;">`;
            }
            
            // Atualizar foto na p√°gina principal
            const fotoPrincipal = document.querySelector('.foto');
            if (fotoPrincipal && data.foto_url) {
                fotoPrincipal.src = data.foto_url;
            }
            
            closeModal();
            
            // Recarregar para atualizar
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        } else {
            alert(data.message || 'Erro ao salvar foto.');
        }
    } catch (error) {
        console.error('Erro ao enviar foto:', error);
        alert('Erro de conex√£o. Tente novamente.');
    }
}

</script>

<!-- Adicionar Font Awesome para √≠cones -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

{%¬†endblock¬†%}