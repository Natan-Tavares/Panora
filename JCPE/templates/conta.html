{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu JC</title>

    <style>
        body {
            margin: 0;
            background: #f2f2f2;
            font-family: Arial, sans-serif;
        }

        /* 1. BOT√ÉO PRINCIPAL (Sempre abre a sidebar) */
        .open-sidebar-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #b30000;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            z-index: 200; 
        }
        
        .open-sidebar-btn:hover {
            background: #8a0000;
        }

        /* 2. OVERLAY ESCURO */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.4);
            opacity: 0;
            visibility: hidden;
            transition: 0.3s;
            z-index: 999;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* 3. SIDEBAR CONTAINER */
        .sidebar {
            position: fixed;
            top: 0;
            right: -380px;
            width: 380px; 
            height: 100%;
            background: white;
            padding: 30px;
            box-shadow: -2px 0 10px rgba(0,0,0,0.2);
            transition: 0.3s;
            z-index: 1000;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .sidebar.active {
            right: 0;
        }

        /* T√≠tulo */
        .sidebar h2 {
            text-align: center;
            color: #a40000;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 26px;
        }
        
        .sidebar h3 {
            text-align: center;
            color: #a40000;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        /* Mensagens de Erro */
        .messages {
            margin-bottom: 12px;
        }

        .messages p {
            background: #ffd2d2;
            padding: 10px;
            border-radius: 8px;
            color: #8a0000;
            font-size: 14px;
        }

        /* Inputs para Login */
        .input {
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            border: none;
            background: #e4edff;
            margin-bottom: 14px;
            font-size: 15px;
            box-sizing: border-box;
        }

        /* Bot√£o principal (Entrar / Sair) */
        .btn-action {
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            border: none;
            background: #b30000;
            color: white;
            font-size: 17px;
            margin-top: 10px;
            cursor: pointer;
            font-weight: bold;
            display: block;
            text-align: center;
            text-decoration: none;
            box-sizing: border-box;
        }
        
        .btn-action:hover {
            background: #8a0000;
        }

        /* Bot√£o secund√°rio (Criar conta / Voltar) */
        .btn-secondary {
            margin-top: 15px;
            width: 100%;
            display: block;
            padding: 12px;
            color: #b30000;
            border: 2px solid #b30000;
            border-radius: 10px;
            text-decoration: none;
            font-weight: bold;
            text-align: center;
            box-sizing: border-box;
            background: white;
            cursor: pointer;
        }

        .btn-secondary:hover {
            background: #ffeaea;
        }

        /* Texto de ajuda para login */
        .login-hint {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-top: 15px;
            margin-bottom: 10px;
        }

        .login-link {
            color: #b30000;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: bold;
            text-decoration: underline;
            padding: 0;
            font-size: 14px;
        }

        .login-link:hover {
            opacity: 0.8;
        }

        /* Link para esqueci a senha */
        .forgot-password-link {
            text-align: center;
            margin-top: 10px;
            margin-bottom: 15px;
        }

        .profile-container {
            padding: 10px 0;
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background: #ccc; 
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            color: #fff;
            font-size: 40px;
            cursor: pointer;
        }

        .change-photo-link {
            color: #b30000;
            text-decoration: none;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }

        .change-photo-link:hover {
            text-decoration: underline;
        }

        /* Blocos de Campos (Nome, Email, Senha) */
        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            color: #444;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .display-field {
            width: 100%;
            padding: 12px;
            border-radius: 5px;
            border: none;
            background: #e9e9e9;
            margin-bottom: 5px;
            font-size: 15px;
            color: #333;
            pointer-events: none;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        .display-field.editable {
            background: #e4edff;
            border: 1px solid #b30000;
            pointer-events: auto;
        }

        .change-link {
            color: #b30000;
            text-decoration: none;
            font-size: 12px;
            cursor: pointer;
            display: inline-block;
            margin-top: 5px;
        }

        .change-link:hover {
            text-decoration: underline;
        }

        /* Bot√µes de confirma√ß√£o/cancelar */
        .edit-buttons {
            display: none;
            gap: 10px;
            margin-top: 10px;
        }

        .edit-buttons.active {
            display: flex;
        }

        .btn-save {
            flex: 1;
            padding: 8px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-save:hover {
            background: #218838;
        }

        .btn-cancel {
            flex: 1;
            padding: 8px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-cancel:hover {
            background: #5a6268;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .modal h3 {
            color: #a40000;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-primary {
            background: #b30000;
            color: white;
        }

        .btn-secondary-modal {
            background: #6c757d;
            color: white;
        }

        .tags-container {
            margin-top: 30px;
            margin-bottom: 40px;
        }

        .tags-container h3 {
            color: #444;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag-item {
            background: #e9e9e9; 
            padding: 8px 12px;
            border-radius: 5px;
            color: #333;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            user-select: none;
            border: none;
        }

        .tag-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 5px rgba(0,0,0,0.1);
        }

        /* Tag selecionada (vermelha com X) */
        .tag-item.selected {
            background: #b30000;
            color: white;
            padding-right: 8px;
            position: relative;
        }

        .tag-item.selected::after {
            content: "√ó";
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            margin-left: 5px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.2s;
        }

        .tag-item.selected:hover::after {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Rodap√©: Bot√µes e Redes Sociais */
        .footer-buttons {
            margin-top: 40px;
            padding-top: 20px;
            text-align: center;
        }

        .social-links {
            display: flex;
            justify-content: space-around;
            margin-top: 25px;
            margin-bottom: 10px;
        }

        .social-links a {
            color: #b30000;
            font-size: 30px;
            text-decoration: none;
            cursor: pointer;
        }
        
        .social-links a:hover {
            opacity: 0.8;
        }

        .logout-button-container {
            background: #fff;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .logout-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        /* Estilos para mensagens tempor√°rias */
        .temp-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 3000;
            animation: slideDown 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            font-size: 14px;
            text-align: center;
            min-width: 200px;
            max-width: 300px;
        }

        @keyframes slideDown {
            from {
                top: -50px;
                opacity: 0;
            }
            to {
                top: 20px;
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        /* Mensagem informativa no login */
        .login-info {
            font-size: 13px;
            color: #666;
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
        }

        /* Instru√ß√µes para recupera√ß√£o de senha */
        .recovery-instructions {
            font-size: 14px;
            color: #666;
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        /* Modal para recupera√ß√£o de senha */
        .recovery-success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: center;
            border: 1px solid #c3e6cb;
        }

        /* Bot√£o para mostrar/ocultar senha */
        .toggle-password {
            position: absolute;
            right: 10px;
            top: 35px;
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            font-size: 12px;
        }

        .toggle-password:hover {
            color: #b30000;
        }

    </style>
</head>
<body>

    <button class="open-sidebar-btn" onclick="openSidebar()" id="sidebarBtn">Login</button>

    <div id="overlay" class="overlay" onclick="closeSidebar()"></div>

    <div id="photoModal" class="modal">
        <div class="modal-content">
            <h3>Alterar Foto de Perfil</h3>
            <p>Selecione uma nova imagem para seu perfil:</p>
            <input type="file" id="photoInput" accept="image/*" style="margin: 15px 0; width: 100%;">
            <div class="modal-buttons">
                <button class="modal-btn btn-primary" onclick="savePhoto()">Salvar</button>
                <button class="modal-btn btn-secondary-modal" onclick="closeModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="sidebar" class="sidebar">
        <div id="loginContent">
            <h2>Entrar</h2>
            
            <div class="login-info">
                Use seu nome de usu√°rio <strong>ou</strong> e-mail para fazer login
            </div>
            
            <form id="loginForm">
                <input type="text" id="loginIdentifier" placeholder="Nome de usu√°rio ou E-mail" class="input" required>
                
                <div style="position: relative;">
                    <input type="password" id="loginPassword" placeholder="Senha" class="input" required>
                    <button type="button" class="toggle-password" onclick="togglePassword('loginPassword')">üëÅÔ∏è</button>
                </div>
                
                <button type="submit" class="btn-action">Entrar</button>
                
                <div class="forgot-password-link">
                    <button type="button" class="login-link" onclick="showForgotPassword()">Esqueci minha senha</button>
                </div>
                
                <div class="login-hint">
                    N√£o tem uma conta? 
                    <button class="login-link" onclick="showRegisterForm()">Criar conta</button>
                </div>
            </form>
        </div>

        <div id="forgotPasswordContent" style="display: none;">
            <h2>Recuperar Senha</h2>
            
            <div class="recovery-instructions">
                Digite seu nome de usu√°rio ou e-mail cadastrado.<br>
                Enviaremos instru√ß√µes para redefinir sua senha.
            </div>
            
            <form id="forgotPasswordForm">
                <input type="text" id="recoveryIdentifier" placeholder="Nome de usu√°rio ou E-mail" class="input" required>
                <button type="submit" class="btn-action">Enviar Instru√ß√µes</button>
                <button type="button" class="btn-secondary" onclick="showLoginForm()">Voltar para Login</button>
            </form>
            
            <div id="recoverySuccess" class="recovery-success" style="display: none;">
                <h3>‚úÖ Instru√ß√µes Enviadas!</h3>
                <p>Enviamos um e-mail com as instru√ß√µes para redefinir sua senha.</p>
                <p><small>Verifique sua caixa de entrada e tamb√©m a pasta de spam.</small></p>
            </div>
        </div>

        <div id="resetPasswordContent" style="display: none;">
            <h2>Redefinir Senha</h2>
            
            <div class="recovery-instructions">
                Digite o c√≥digo de recupera√ß√£o recebido por e-mail e sua nova senha.
            </div>
            
            <form id="resetPasswordForm">
                <input type="text" id="recoveryCode" placeholder="C√≥digo de recupera√ß√£o" class="input" required>
                
                <div style="position: relative;">
                    <input type="password" id="newPassword" placeholder="Nova senha (m√≠nimo 6 caracteres)" class="input" required>
                    <button type="button" class="toggle-password" onclick="togglePassword('newPassword')">üëÅÔ∏è</button>
                </div>
                
                <div style="position: relative;">
                    <input type="password" id="confirmNewPassword" placeholder="Confirmar nova senha" class="input" required>
                    <button type="button" class="toggle-password" onclick="togglePassword('confirmNewPassword')">üëÅÔ∏è</button>
                </div>
                
                <button type="submit" class="btn-action">Redefinir Senha</button>
                <button type="button" class="btn-secondary" onclick="showForgotPassword()">Voltar</button>
            </form>
        </div>

        <div id="registerContent" style="display: none;">
            <h2>Criar Conta</h2>
            
            <div class="login-info">
                Voc√™ poder√° fazer login usando seu nome de usu√°rio <strong>ou</strong> e-mail
            </div>
            
            <form id="registerForm">
                <input type="text" id="registerUsername" placeholder="Nome de usu√°rio (m√≠nimo 3 caracteres)" class="input" required>
                <input type="email" id="registerEmail" placeholder="E-mail" class="input" required>
                
                <div style="position: relative;">
                    <input type="password" id="registerPassword" placeholder="Senha (m√≠nimo 6 caracteres)" class="input" required>
                    <button type="button" class="toggle-password" onclick="togglePassword('registerPassword')">üëÅÔ∏è</button>
                </div>
                
                <div style="position: relative;">
                    <input type="password" id="registerConfirmPassword" placeholder="Confirmar senha" class="input" required>
                    <button type="button" class="toggle-password" onclick="togglePassword('registerConfirmPassword')">üëÅÔ∏è</button>
                </div>
                
                <button type="submit" class="btn-action">Criar Conta</button>
                <button type="button" class="btn-secondary" onclick="showLoginForm()">Voltar para Login</button>
            </form>
        </div>

        <div id="profileContent" style="display: none;">
            <div class="profile-container">
                <div class="profile-header">
                    <div class="profile-avatar" title="Clique para alterar" onclick="openPhotoModal()">üë§</div>
                    <a href="#" class="change-photo-link" onclick="openPhotoModal(); return false;">Alterar foto de perfil</a>
                </div>

                <div class="form-group" id="usernameGroup">
                    <label>Nome de Usu√°rio</label>
                    <input type="text" id="usernameInput" class="display-field" readonly>
                    <a href="#" class="change-link" onclick="enableEdit('username'); return false;">Alterar nome de usu√°rio</a>
                    <div class="edit-buttons" id="usernameButtons">
                        <button class="btn-save" onclick="saveEdit('username')">Salvar</button>
                        <button class="btn-cancel" onclick="cancelEdit('username')">Cancelar</button>
                    </div>
                </div>
                
                <div class="form-group" id="emailGroup">
                    <label>E-mail</label>
                    <input type="email" id="emailInput" class="display-field" readonly>
                    <a href="#" class="change-link" onclick="enableEdit('email'); return false;">Alterar e-mail</a>
                    <div class="edit-buttons" id="emailButtons">
                        <button class="btn-save" onclick="saveEdit('email')">Salvar</button>
                        <button class="btn-cancel" onclick="cancelEdit('email')">Cancelar</button>
                    </div>
                </div>

                <div class="form-group" id="passwordGroup">
                    <label>Senha</label>
                    <div style="position: relative;">
                        <input type="password" id="passwordInput" value="********" class="display-field" readonly>
                        <button type="button" class="toggle-password" onclick="togglePassword('passwordInput')" style="top: 12px;">üëÅÔ∏è</button>
                    </div>
                    <a href="#" class="change-link" onclick="enableEdit('password'); return false;">Alterar senha</a>
                    <div class="edit-buttons" id="passwordButtons">
                        <button class="btn-save" onclick="saveEdit('password')">Salvar</button>
                        <button class="btn-cancel" onclick="cancelEdit('password')">Cancelar</button>
                    </div>
                </div>

                <div class="tags-container">
                    <h3>Tags de Interesse</h3>
                    <div class="tags-list" id="tagsList">
                        <div class="loading-tags">Carregando tags...</div>
                    </div>
                    <p style="font-size: 11px; color: #666; margin-top: 10px;">
                        As tags s√£o salvas automaticamente no seu navegador.
                    </p>
                </div>

                <div class="footer-buttons">
                    <div class="logout-button-container">
                         <button class="btn-action" style="margin-top: 0; background: #b30000;" onclick="logout()">Sair da Conta</button>
                         <p class="logout-text">Op√ß√µes de conta</p>
                    </div>

                    <table style="margin: 0 auto; border-collapse: collapse; border-spacing: 0;">
    <tr>
        <td style="padding: 4px 8px;">
            <a href="https://www.instagram.com/jc_pe/?hl=en" target="_blank" rel="noopener noreferrer" 
               style="display: inline-block; text-decoration: none;">
                <img src="{% static 'img/instagram.png' %}" alt="Instagram" 
                     style="width: 30px; height: 30px; display: block;">
            </a>
        </td>
        <td style="padding: 4px 8px;">
            <a href="https://x.com/jc_pe?lang=en" target="_blank" rel="noopener noreferrer" 
               style="display: inline-block; text-decoration: none;">
                <img src="{% static 'img/x.png' %}" alt="X" 
                     style="width: 30px; height: 30px; display: block;">
            </a>
        </td>
        <td style="padding: 4px 8px;">
            <a href="https://www.tiktok.com/@jc_pe" target="_blank" rel="noopener noreferrer" 
               style="display: inline-block; text-decoration: none;">
                <img src="{% static 'img/tiktok.png' %}" alt="TikTok" 
                     style="width: 30px; height: 30px; display: block;">
            </a>
        </td>
    </tr>
</table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isLoggedIn = false;
        let currentUser = null;
        let recoveryUser = null;

        const TAGS_DATA = [
            {id: 'educacao', name: 'Educa√ß√£o'},
            {id: 'cinema', name: 'Cinema'},
            {id: 'esportes', name: 'Esportes'},
            {id: 'mundo', name: 'Mundo'},
            {id: 'tech', name: 'Tech'},
            {id: 'politica', name: 'Pol√≠tica'},
            {id: 'musica', name: 'M√∫sica'},
            {id: 'games', name: 'Games'},
            {id: 'arte', name: 'Arte'},
            {id: 'ciencia', name: 'Ci√™ncia'}
        ];

        function openSidebar() {
            document.getElementById("sidebar").classList.add("active");
            document.getElementById("overlay").classList.add("active");
            
            if (isLoggedIn) {
                loadTags();
            }
        }

        function closeSidebar() {
            document.getElementById("sidebar").classList.remove("active");
            document.getElementById("overlay").classList.remove("active");
        }

        function showForgotPassword() {
            document.getElementById("loginContent").style.display = "none";
            document.getElementById("registerContent").style.display = "none";
            document.getElementById("forgotPasswordContent").style.display = "block";
            document.getElementById("resetPasswordContent").style.display = "none";
            document.getElementById("profileContent").style.display = "none";
            document.getElementById("recoverySuccess").style.display = "none";
            document.getElementById("forgotPasswordForm").reset();
        }

        function showResetPassword() {
            document.getElementById("loginContent").style.display = "none";
            document.getElementById("registerContent").style.display = "none";
            document.getElementById("forgotPasswordContent").style.display = "none";
            document.getElementById("resetPasswordContent").style.display = "block";
            document.getElementById("profileContent").style.display = "none";
            document.getElementById("resetPasswordForm").reset();
        }

        function showRegisterForm() {
            document.getElementById("loginContent").style.display = "none";
            document.getElementById("registerContent").style.display = "block";
            document.getElementById("forgotPasswordContent").style.display = "none";
            document.getElementById("resetPasswordContent").style.display = "none";
            document.getElementById("profileContent").style.display = "none";
            document.getElementById("registerForm").reset();
        }

        function showLoginForm() {
            document.getElementById("loginContent").style.display = "block";
            document.getElementById("registerContent").style.display = "none";
            document.getElementById("forgotPasswordContent").style.display = "none";
            document.getElementById("resetPasswordContent").style.display = "none";
            document.getElementById("profileContent").style.display = "none";
            document.getElementById("loginForm").reset();
            document.getElementById("forgotPasswordForm").reset();
            document.getElementById("resetPasswordForm").reset();
            document.getElementById("recoverySuccess").style.display = "none";
        }

        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            if (input.type === "password") {
                input.type = "text";
            } else {
                input.type = "password";
            }
        }

        function checkLoginStatus() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                isLoggedIn = true;
                currentUser = JSON.parse(savedUser);
                document.getElementById('sidebarBtn').textContent = 'Minha Conta';
                document.getElementById('loginContent').style.display = 'none';
                document.getElementById('registerContent').style.display = 'none';
                document.getElementById('forgotPasswordContent').style.display = 'none';
                document.getElementById('resetPasswordContent').style.display = 'none';
                document.getElementById('profileContent').style.display = 'block';
                
                document.getElementById('usernameInput').value = currentUser.username;
                document.getElementById('emailInput').value = currentUser.email;
            } else {
                isLoggedIn = false;
                currentUser = null;
                document.getElementById('sidebarBtn').textContent = 'Login';
                showLoginForm();
            }
        }

        function getUsers() {
            const users = localStorage.getItem('registeredUsers');
            return users ? JSON.parse(users) : [];
        }

        function saveUsers(users) {
            localStorage.setItem('registeredUsers', JSON.stringify(users));
        }

        function findUserByIdentifier(identifier) {
            const users = getUsers();
            
            if (validateEmail(identifier)) {
                return users.find(user => 
                    user.email.toLowerCase() === identifier.toLowerCase()
                );
            } else {
                return users.find(user => 
                    user.username.toLowerCase() === identifier.toLowerCase()
                );
            }
        }

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const identifier = document.getElementById('loginIdentifier').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!identifier || !password) {
                showMessage('Por favor, preencha todos os campos.', 'error');
                return;
            }
            
            const user = findUserByIdentifier(identifier);
            
            if (!user) {
                showMessage('Usu√°rio ou e-mail n√£o encontrado.', 'error');
                return;
            }
            
            if (user.password !== password) {
                showMessage('Senha incorreta.', 'error');
                return;
            }
            
            currentUser = {
                id: user.id,
                username: user.username,
                email: user.email,
                name: user.name || user.username
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showMessage(`Bem-vindo, ${user.username}!`, 'success');
            checkLoginStatus();
            
            document.getElementById('loginForm').reset();
            
            setTimeout(() => {
                closeSidebar();
            }, 1500);
        });

        document.getElementById('forgotPasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const identifier = document.getElementById('recoveryIdentifier').value.trim();
            
            if (!identifier) {
                showMessage('Por favor, digite seu nome de usu√°rio ou e-mail.', 'error');
                return;
            }
            
            const user = findUserByIdentifier(identifier);
            
            if (!user) {
                showMessage('Usu√°rio ou e-mail n√£o encontrado.', 'error');
                return;
            }
            
            recoveryUser = user;
            
            const recoveryCode = generateRecoveryCode();
            
            localStorage.setItem('recoveryCode_' + user.id, recoveryCode);
            localStorage.setItem('recoveryUser', JSON.stringify(user));
            
            document.getElementById('recoverySuccess').style.display = 'block';
            
            showMessage(`C√≥digo de recupera√ß√£o: ${recoveryCode} (Simula√ß√£o - em produ√ß√£o seria enviado por e-mail)`, 'info');
            
            setTimeout(() => {
                showResetPassword();
            }, 4000);
        });

        document.getElementById('resetPasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const code = document.getElementById('recoveryCode').value.trim();
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            
            const savedRecoveryUser = JSON.parse(localStorage.getItem('recoveryUser') || 'null');
            
            if (!savedRecoveryUser) {
                showMessage('Sess√£o de recupera√ß√£o expirada. Por favor, inicie o processo novamente.', 'error');
                showForgotPassword();
                return;
            }
            
            const savedCode = localStorage.getItem('recoveryCode_' + savedRecoveryUser.id);
            
            if (!savedCode || savedCode !== code) {
                showMessage('C√≥digo de recupera√ß√£o inv√°lido.', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showMessage('A senha deve ter pelo menos 6 caracteres.', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showMessage('As senhas n√£o coincidem.', 'error');
                return;
            }
            
            const users = getUsers();
            const userIndex = users.findIndex(user => user.id === savedRecoveryUser.id);
            
            if (userIndex !== -1) {
                users[userIndex].password = newPassword;
                saveUsers(users);
                
                localStorage.removeItem('recoveryCode_' + savedRecoveryUser.id);
                localStorage.removeItem('recoveryUser');
                
                showMessage('Senha redefinida com sucesso! Fa√ßa login com sua nova senha.', 'success');
                
                setTimeout(() => {
                    showLoginForm();
                }, 2000);
            } else {
                showMessage('Usu√°rio n√£o encontrado.', 'error');
            }
        });

        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('registerUsername').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (!username || !email || !password || !confirmPassword) {
                showMessage('Por favor, preencha todos os campos.', 'error');
                return;
            }
            
            if (!validateEmail(email)) {
                showMessage('Por favor, insira um e-mail v√°lido.', 'error');
                return;
            }
            
            if (password.length < 6) {
                showMessage('A senha deve ter pelo menos 6 caracteres.', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('As senhas n√£o coincidem.', 'error');
                return;
            }
            
            if (username.length < 3) {
                showMessage('O nome de usu√°rio deve ter pelo menos 3 caracteres.', 'error');
                return;
            }
            
            const users = getUsers();
            const usernameExists = users.some(user => 
                user.username.toLowerCase() === username.toLowerCase()
            );
            
            const emailExists = users.some(user => 
                user.email.toLowerCase() === email.toLowerCase()
            );
            
            if (usernameExists) {
                showMessage('Este nome de usu√°rio j√° est√° em uso.', 'error');
                return;
            }
            
            if (emailExists) {
                showMessage('Este e-mail j√° est√° cadastrado.', 'error');
                return;
            }
            
            const newUser = {
                id: Date.now(),
                username: username,
                email: email,
                password: password,
                name: username,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            saveUsers(users);
            
            currentUser = {
                id: newUser.id,
                username: newUser.username,
                email: newUser.email,
                name: newUser.name
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showMessage(`Conta criada com sucesso! Bem-vindo, ${username}!`, 'success');
            checkLoginStatus();
            
            document.getElementById('registerForm').reset();
            
            setTimeout(() => {
                closeSidebar();
            }, 2000);
        });

        function logout() {
            localStorage.removeItem('currentUser');
            isLoggedIn = false;
            currentUser = null;
            showMessage('Logout realizado com sucesso!', 'success');
            checkLoginStatus();
            showLoginForm();
            closeSidebar();
        }

        function generateRecoveryCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        function openPhotoModal() {
            document.getElementById("photoModal").classList.add("active");
        }

        function closeModal() {
            document.getElementById("photoModal").classList.remove("active");
            document.getElementById("photoInput").value = '';
        }

        function savePhoto() {
            const fileInput = document.getElementById("photoInput");
            const file = fileInput.files[0];
            
            if (file) {
                showMessage('Foto alterada com sucesso! (Simula√ß√£o)', 'success');
                document.querySelector('.profile-avatar').innerHTML = 'üñºÔ∏è';
                closeModal();
            } else {
                alert('Por favor, selecione uma imagem.');
            }
        }

        function enableEdit(field) {
            const input = document.getElementById(field + 'Input');
            const buttons = document.getElementById(field + 'Buttons');
            const changeLink = input.nextElementSibling;
            
            window.originalValues = window.originalValues || {};
            window.originalValues[field] = input.value;
            
            input.classList.add('editable');
            input.readOnly = false;
            
            if (field === 'password') {
                input.type = 'password';
                input.value = '';
                input.placeholder = 'Digite a nova senha';
            }
            
            changeLink.style.display = 'none';
            buttons.classList.add('active');
            input.focus();
        }

        function saveEdit(field) {
            const input = document.getElementById(field + 'Input');
            const buttons = document.getElementById(field + 'Buttons');
            const changeLink = buttons.previousElementSibling;
            const newValue = input.value.trim();
            
            if (!newValue) {
                alert('Por favor, preencha o campo.');
                return;
            }
            
            if (field === 'email') {
                if (!validateEmail(newValue)) {
                    alert('Por favor, insira um e-mail v√°lido.');
                    return;
                }
                
                const users = getUsers();
                const emailExists = users.some(user => 
                    user.email.toLowerCase() === newValue.toLowerCase() && 
                    user.id !== currentUser.id
                );
                
                if (emailExists) {
                    alert('Este e-mail j√° est√° sendo usado por outro usu√°rio.');
                    return;
                }
            }
            
            if (field === 'password') {
                if (newValue.length < 6) {
                    alert('A senha deve ter pelo menos 6 caracteres.');
                    return;
                }
            }
            
            if (field === 'username') {
                if (newValue.length < 3) {
                    alert('O nome de usu√°rio deve ter pelo menos 3 caracteres.');
                    return;
                }
                
                const users = getUsers();
                const usernameExists = users.some(user => 
                    user.username.toLowerCase() === newValue.toLowerCase() && 
                    user.id !== currentUser.id
                );
                
                if (usernameExists) {
                    alert('Este nome de usu√°rio j√° est√° sendo usado.');
                    return;
                }
            }
            
            const users = getUsers();
            const userIndex = users.findIndex(user => user.id === currentUser.id);
            
            if (userIndex !== -1) {
                if (field === 'password') {
                    users[userIndex].password = newValue;
                    input.type = 'password';
                    input.value = '********';
                } else {
                    users[userIndex][field] = newValue;
                    currentUser[field] = newValue;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                }
                
                saveUsers(users);
                showMessage(`${field === 'username' ? 'Nome de usu√°rio' : field === 'email' ? 'E-mail' : 'Senha'} atualizado com sucesso!`, 'success');
            }
            
            input.classList.remove('editable');
            input.readOnly = true;
            buttons.classList.remove('active');
            changeLink.style.display = 'inline-block';
        }

        function cancelEdit(field) {
            const input = document.getElementById(field + 'Input');
            const buttons = document.getElementById(field + 'Buttons');
            const changeLink = buttons.previousElementSibling;
            
            if (field === 'password') {
                input.value = '********';
                input.type = 'password';
            } else if (window.originalValues && window.originalValues[field]) {
                input.value = window.originalValues[field];
            }
            
            input.classList.remove('editable');
            input.readOnly = true;
            buttons.classList.remove('active');
            changeLink.style.display = 'inline-block';
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function loadTags() {
            const tagsList = document.getElementById('tagsList');
            if (!tagsList) return;
            
            const savedTags = JSON.parse(localStorage.getItem('selectedTags') || '[]');
            
            tagsList.innerHTML = '';
            
            TAGS_DATA.forEach(tag => {
                const isSelected = savedTags.includes(tag.id);
                const tagElement = document.createElement('button');
                tagElement.type = 'button';
                tagElement.className = 'tag-item';
                if (isSelected) tagElement.classList.add('selected');
                tagElement.setAttribute('data-tag', tag.id);
                tagElement.setAttribute('data-name', tag.name);
                tagElement.textContent = tag.name;
                tagElement.title = `Clique para ${isSelected ? 'remover' : 'adicionar'} esta tag`;
                tagsList.appendChild(tagElement);
            });
            
            setupTagEvents();
        }

        function setupTagEvents() {
            const tags = document.querySelectorAll('.tag-item');
            
            tags.forEach(tag => {
                tag.addEventListener('click', function() {
                    const tagId = this.getAttribute('data-tag');
                    const tagName = this.getAttribute('data-name');
                    const isSelected = this.classList.contains('selected');
                    
                    this.classList.toggle('selected');
                    
                    updateLocalStorageTags();
                    
                    showMessage(
                        `Tag "${tagName}" ${isSelected ? 'removida' : 'adicionada'}!`, 
                        'success'
                    );
                });
            });
        }

        function updateLocalStorageTags() {
            const tags = document.querySelectorAll('.tag-item');
            const selectedTags = [];
            tags.forEach(tag => {
                if (tag.classList.contains('selected')) {
                    selectedTags.push(tag.getAttribute('data-tag'));
                }
            });
            localStorage.setItem('selectedTags', JSON.stringify(selectedTags));
        }

        function showMessage(text, type) {
            const existingMessages = document.querySelectorAll('.temp-message');
            existingMessages.forEach(msg => msg.remove());
            
            const colors = {
                'success': '#28a745',
                'error': '#dc3545',
                'info': '#17a2b8',
                'warning': '#ffc107'
            };
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `temp-message ${type}`;
            messageDiv.textContent = text;
            messageDiv.style.background = colors[type] || colors.info;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.style.animation = 'fadeOut 0.3s ease';
                    setTimeout(() => {
                        if (messageDiv.parentNode) {
                            messageDiv.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }

        document.addEventListener('keydown', function(event) {
            if (event.target.tagName !== 'INPUT' && event.key === 'Escape') {
                closeSidebar();
                closeModal();
            }
        });

        document.getElementById('photoModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeModal();
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            
            document.querySelectorAll('.toggle-password').forEach(button => {
                button.addEventListener('click', function() {
                    const inputId = this.getAttribute('onclick').match(/'([^']+)'/)[1];
                    togglePassword(inputId);
                });
            });
        });

    function openSocialLink(button) {
        const link = button.getAttribute('data-link');
        if (link) {
            window.open(link, '_blank', 'noopener,noreferrer');
        }
    }

    </script>

</body>
</html>