{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>{{ noticia.titulo }} - JCPE</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="icon" href="{% static 'img/logo_jcpe.png' %}">
</head>
<body>
    <header>
        <a href="{% url 'inicial' %}">
            <img src="{% static 'img/logo_jcpe.png' %}" alt="Logo JCPE" class="logo">
        </a>
        <h1>JCPE - Jornal do Commercio de Pernambuco</h1>
    </header>

    <main>
        <h1>{{ noticia.titulo }}</h1>

        {% if noticia.capa %}
            <div style="text-align:center; margin: 20px 0;">
                <img src="{{ noticia.capa.url }}" alt="Capa da not√≠cia" style="max-width:80%; border-radius:10px;">
            </div>
        {% endif %}

        {% if noticia.subtitulo %}
            <h3 style="text-align:center; color:#555;">{{ noticia.subtitulo }}</h3>
        {% endif %}

        <p>{{ noticia.materia|linebreaks }}</p>

        {% if noticia.imagem %}
            <div style="text-align:center; margin-top:20px;">
                <img src="{{ noticia.imagem.url }}" alt="Imagem da not√≠cia" style="max-width:70%; border-radius:10px;">
            </div>
        {% endif %}

        <small>
            <p>
                <b>Autor:</b> {{ noticia.autor }} |
                <b>Publicada em:</b> {{ noticia.data_criacao|date:"d/m/Y H:i" }}
            </p>
            {% if noticia.local %}
                <p><strong>Local:</strong> {{ noticia.local }}</p>
            {% endif %}
            {% if noticia.categoria %}
                <p><strong>Categoria:</strong> {{ noticia.categoria.categoria }}</p>
            {% endif %}
            {% if noticia.tags.all %}
                <p><strong>Tags:</strong>
                    {% for tag in noticia.tags.all %}
                        {{ tag.tag }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
            {% endif %}
            {% if noticia.fontes %}
                <p><strong>Fontes:</strong> {{ noticia.fontes }}</p>
            {% endif %}
        </small>

        <hr>
        <h2>Respostas</h2>

        {% with comentarios_raiz=noticia.resposta_set.all|dictsort:"data_criacao" %}
            {% for comentario in comentarios_raiz %}
                {% if not comentario.pai %}
                    <div style="margin-bottom:15px;">
                        <p><b>{{ comentario.usuario }}</b>: {{ comentario.texto }}</p>
                        <small>{{ comentario.data_criacao|date:"d/m/Y H:i" }}</small>
                        <br>
                        <a href="{% url 'inserir_resposta' noticia.id %}?pai={{ comentario.id }}">Responder</a>

                        {% for filho in comentario.comentarios_filho.all %}
                            <div style="margin-left: 30px;">
                                <p><b>{{ filho.usuario }}</b>: {{ filho.texto }}</p>
                                <small>{{ filho.data_criacao|date:"d/m/Y H:i" }}</small>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% empty %}
                <p>N√£o h√° respostas para esta not√≠cia.</p>
            {% endfor %}
        {% endwith %}

        <form action="{% url 'salvar_noticia' noticia.id %}" method="POST" style="text-align: center; margin-top: 20px;">
            {% csrf_token %}
            <button type="submit" class="button">‚≠ê Salvar not√≠cia</button>
        </form>

        <div class="links-centrais">
            <a href="{% url 'inserir_resposta' noticia.id %}" class="button">üí¨ Responder</a>
            <a href="{% url 'inicial' %}" class="button">‚¨Ö Voltar</a>
            <a href="{% url 'apagar_noticia' noticia.id %}" class="button excluir">üóë Apagar</a>
        </div>
    </main>

    <footer>
        &copy; 2025 JCPE - Todos os direitos reservados.
    </footer>
</body>
</html>
